# This file was generated by Ansible for {{ ansible_fqdn }}
# Do NOT modify this file by hand!

{% if nginx_enable_dynamic_modules %}
include {{ nginx_dir }}/modules-enabled/*;
{% endif %}

user  {{nginx_user}};
worker_processes  {{nginx_worker_processes}};

events {
    multi_accept  {{'on' if nginx_multi_accept else 'off'}};
    worker_connections  {{nginx_worker_connections}};
}

{% if nginx_streams_dir %}
streams {
    include {{nginx_streams_dir}}/*;
}
{% endif %}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile {{'on' if nginx_sendfile else 'off'}};

    tcp_nodelay {{'on' if nginx_tcp_nodelay else 'off'}};
    tcp_nopush {{'on' if nginx_tcp_nopush else 'off'}};

{% if nginx_open_file_cache %}
    open_file_cache max=200000 inactive=20s;
    open_file_cache_valid 30s;
    open_file_cache_min_uses 2;
    open_file_cache_errors on;
{% endif %}

    keepalive_timeout  {{nginx_keepalive_timeout}};
    keepalive_requests  {{nginx_keepalive_requests}};

{% if nginx_gzip %}
    gzip on;
    gzip_disable "msie6";
    gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript application/javascript;
{% endif %}

    server_names_hash_bucket_size {{nginx_server_names_hash_bucket_size}};

{% if nginx_http_options %}{% for option in nginx_http_options %}
    {{option}}
{% endfor %}{% endif %}

    access_log {{nginx_access_log}};
    error_log {{nginx_error_log}};

{% if nginx_status %}
    server {
        listen {{ nginx_status }};
        location / {
            access_log off;
            allow 127.0.0.1;
            deny all;
            stub_status on;
        }
    }
{% endif %}

{% if nginx_servers %}{% for server_config in nginx_servers %}
    server {
        {{ server_config.split('\n')|join('\t\n') }}
    }
{% endfor %}{% endif %}

    include {{nginx_dir}}/conf.d/*.conf;
    include {{nginx_sites_dir}}/*;
}
